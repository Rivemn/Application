# ===== Stage 1: Build =====
FROM node:20-alpine AS build

WORKDIR /app
COPY package*.json ./
RUN npm ci

ARG NODE_ENV=production
ARG BACKEND_URL=http://localhost:5000

ENV NODE_ENV=$NODE_ENV
ENV BACKEND_URL=$BACKEND_URL

COPY . .
RUN npm run build -- --configuration production

# ===== Stage 2: Nginx serve =====
FROM nginx:alpine

# üéØ –ö–û–ü–ò–†–£–ï–ú –ò–ú–ï–ù–ù–û –ò–ó –ü–ê–ü–ö–ò /browser
COPY --from=build /app/dist/frontend/browser /usr/share/nginx/html

# ‚úÖ –£–°–¢–ê–ù–ê–í–õ–ò–í–ê–ï–ú –ü–†–ê–í–ò–õ–¨–ù–´–ï –ü–†–ê–í–ê
RUN chown -R nginx:nginx /usr/share/nginx/html

# –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º nginx –¥–ª—è SPA
RUN rm /etc/nginx/conf.d/default.conf
COPY nginx.conf /etc/nginx/conf.d/default.conf

# EXPOSE 80 –Ω–µ –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω, –Ω–æ –¥–ª—è —è—Å–Ω–æ—Å—Ç–∏ –º–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å
EXPOSE 80

CMD ["nginx", "-g", "daemon off;"]
